import os
import csv

def process_logs(log_dir):
    logs = []
    for filename in os.listdir(log_dir):
        if filename.startswith("apiminer_traces") and filename.endswith(".txt"):
            file_path = os.path.join(log_dir, filename)
            with open(file_path, "r", encoding="utf-8") as f:
                api_calls = [line.strip() for line in f.readlines()]
                logs.append({"filename": filename[:-4], "api_calls": api_calls})
    return logs

def main():
    log_dir = "C:/"

    all_logs = process_logs(log_dir)

    # Write the extracted information to a CSV file
    with open("apiminer_features.csv", "w", newline="", encoding="utf-8") as csvfile:
        fieldnames = ["filename", "api_calls"]
        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
        writer.writeheader()
        writer.writerows(all_logs)

    print("API feature extraction completed. Results saved to 'apiminer_features.csv'.")

if __name__ == "__main__":
    main()